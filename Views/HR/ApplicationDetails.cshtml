@using TalentAI.Models
@model JobApplication
@{
    ViewData["Title"] = "Application Details - " + Model.CandidateEmail;
    var jobTitle = ViewBag.JobTitle as string;

    // Color-coded status helpers
    string statusBg, statusColor, statusBorder;
    switch (Model.Status)
    {
        case "Approved":
            statusBg = "rgba(52, 211, 153, 0.15)"; statusColor = "#34d399"; statusBorder = "rgba(52, 211, 153, 0.3)";
            break;
        case "Rejected":
            statusBg = "rgba(239, 68, 68, 0.15)"; statusColor = "#ef4444"; statusBorder = "rgba(239, 68, 68, 0.3)";
            break;
        case "Shortlisted":
            statusBg = "rgba(250, 204, 21, 0.15)"; statusColor = "#facc15"; statusBorder = "rgba(250, 204, 21, 0.3)";
            break;
        default: // Under Review
            statusBg = "rgba(192, 132, 252, 0.15)"; statusColor = "#e879f9"; statusBorder = "rgba(192, 132, 252, 0.3)";
            break;
    }
}

<div class="page-header">
    <a href="/hr/job/@Model.JobId" style="color: var(--text-muted); text-decoration: none; font-size: 0.85rem; display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
        &larr; Back to Job Applicants
    </a>
    <h2 style="margin: 0; margin-bottom: 0.5rem; font-size: 2rem;">Application Review</h2>
    <p style="color: var(--text-muted);">Review candidate application data for <strong>@jobTitle</strong>.</p>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="response-message success" style="margin-bottom: 1.5rem;">@TempData["SuccessMessage"]</div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="response-message error" style="margin-bottom: 1.5rem;">@TempData["ErrorMessage"]</div>
}

<div style="display: grid; grid-template-columns: 1fr; gap: 2rem; max-width: 800px;">
    
    <div style="background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 2rem;">
        <h3 style="margin-top: 0; color: var(--secondary); font-size: 1.1rem; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border);">Applicant Information</h3>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
            <div>
                <strong style="display: block; color: var(--text-muted); font-size: 0.85rem; text-transform: uppercase; margin-bottom: 0.25rem;">Email Address</strong>
                <div style="font-size: 1.1rem;">@Model.CandidateEmail</div>
            </div>

            <div>
                <strong style="display: block; color: var(--text-muted); font-size: 0.85rem; text-transform: uppercase; margin-bottom: 0.25rem;">Date Applied</strong>
                <div style="font-size: 1.1rem;">@Model.AppliedAt.ToString("MMMM dd, yyyy")</div>
            </div>

            <div>
                <strong style="display: block; color: var(--text-muted); font-size: 0.85rem; text-transform: uppercase; margin-bottom: 0.25rem;">Current Status</strong>
                <span style="background: @statusBg; color: @statusColor; padding: 0.3rem 0.8rem; border-radius: 999px; font-size: 0.9rem; border: 1px solid @statusBorder; display: inline-block; margin-top: 0.25rem;">
                    @Model.Status
                </span>
            </div>
        </div>

        <!-- Status Update Form -->
        <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
            <h3 style="margin-top: 0; color: var(--text); font-size: 1.1rem; margin-bottom: 1rem;">Update Status</h3>
            <form method="post" action="/hr/application/update-status/@Model.Id" style="display: flex; gap: 1rem; align-items: flex-end;">
                <div style="flex: 1;">
                    <label style="display: block; color: var(--text-muted); font-size: 0.85rem; text-transform: uppercase; margin-bottom: 0.5rem;">New Status</label>
                    <select name="newStatus" style="width: 100%; padding: 0.75rem 1rem; background: var(--bg); color: var(--text); border: 1px solid var(--border); border-radius: var(--radius); font-size: 0.95rem; cursor: pointer; appearance: auto;">
                        <option value="Under Review" selected="@(Model.Status == "Under Review")">Under Review</option>
                        <option value="Shortlisted" selected="@(Model.Status == "Shortlisted")">Shortlisted</option>
                        <option value="Approved" selected="@(Model.Status == "Approved")">Approved</option>
                        <option value="Rejected" selected="@(Model.Status == "Rejected")">Rejected</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary" style="padding: 0.75rem 1.5rem; white-space: nowrap;">
                    Update Status
                </button>
            </form>
        </div>

        <!-- Resume Section -->
        <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
            <h3 style="margin-top: 0; color: var(--text); font-size: 1.1rem; margin-bottom: 1rem;">Provided Resume</h3>
            
            @if (string.IsNullOrEmpty(Model.ResumeFilePath))
            {
                <div class="response-message error" style="margin: 0; background: rgba(239, 68, 68, 0.1); color: var(--error);">
                    No resume document was attached to this application.
                </div>
            }
            else
            {
                <div style="display: flex; align-items: center; justify-content: space-between; background: rgba(0,0,0,0.2); padding: 1.5rem; border-radius: var(--radius); border: 1px dashed rgba(255,255,255,0.1);">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <svg style="color: var(--secondary);" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                        <div>
                            <div style="font-weight: 500;">Candidate_Resume_Document</div>
                            <div style="font-size: 0.85rem; color: var(--text-muted);">PDF / DOCX File</div>
                        </div>
                    </div>
                    
                    <a href="@Model.ResumeFilePath" target="_blank" class="btn-primary" style="padding: 0.6rem 1.5rem; text-decoration: none; font-size: 0.9rem;">
                        View Document
                    </a>
                </div>
            }
        </div>
    </div>

</div>
