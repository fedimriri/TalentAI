@using TalentAI.Models
@using TalentAI.DTOs
@model List<CandidateJobDto>
@{
    var candidate = ViewBag.Candidate as User;
    ViewData["Title"] = "Candidate Dashboard";
}

<div class="page-header">
    <h2>Welcome back!</h2>
    <p>Manage your profile and track your job applications below.</p>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="response-message success" style="margin-bottom: 1.5rem;">@TempData["SuccessMessage"]</div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="response-message error" style="margin-bottom: 1.5rem;">@TempData["ErrorMessage"]</div>
}

<div style="display: grid; grid-template-columns: 1fr; gap: 2rem;">
    
    <!-- Profile Info -->
    <div style="background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 1.5rem;">
        <h3 style="margin-top: 0; color: var(--secondary); font-size: 1.1rem; margin-bottom: 1rem;">Profile Information</h3>
        
        <div style="display: flex; flex-direction: column; gap: 0.75rem; color: var(--text-muted);">
            <div><strong style="color: var(--text);">Email:</strong> @candidate?.Email</div>
            <div><strong style="color: var(--text);">Role:</strong> @candidate?.Role</div>
            <div><strong style="color: var(--text);">Joined:</strong> @candidate?.CreatedAt.ToString("MMMM dd, yyyy")</div>
        </div>
    </div>

    <!-- Applied Jobs -->
    <div>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3 style="margin: 0; font-size: 1.25rem;">My Applications</h3>
            <a href="/candidate/feed" class="btn-primary" style="padding: 0.5rem 1rem; font-size: 0.9rem;">Find New Jobs</a>
        </div>

        @if (Model.Count == 0)
        {
            <div style="padding: 2.5rem; text-align: center; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius);">
                <p style="color: var(--text-muted); margin-bottom: 1.5rem; margin-top: 0;">You haven't applied to any jobs yet.</p>
                <a href="/candidate/feed" style="color: var(--secondary); text-decoration: none; font-weight: 500;">Browse active job postings &rarr;</a>
            </div>
        }
        else
        {
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; background: var(--surface); border-radius: var(--radius); overflow: hidden; border: 1px solid var(--border);">
                    <thead style="background: rgba(0,0,0,0.2); text-align: left; color: var(--text-muted); font-size: 0.85rem; text-transform: uppercase;">
                        <tr>
                            <th style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--border);">Job Title</th>
                            <th style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--border);">Date Applied</th>
                            <th style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--border);">Status</th>
                            <th style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--border); text-align: right;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var job in Model)
                        {
                            // Color-coded status
                            string sBg, sColor, sBorder;
                            switch (job.Status)
                            {
                                case "Approved":
                                    sBg = "rgba(52, 211, 153, 0.15)"; sColor = "#34d399"; sBorder = "rgba(52, 211, 153, 0.3)";
                                    break;
                                case "Rejected":
                                    sBg = "rgba(239, 68, 68, 0.15)"; sColor = "#ef4444"; sBorder = "rgba(239, 68, 68, 0.3)";
                                    break;
                                case "Shortlisted":
                                    sBg = "rgba(250, 204, 21, 0.15)"; sColor = "#facc15"; sBorder = "rgba(250, 204, 21, 0.3)";
                                    break;
                                default:
                                    sBg = "rgba(192, 132, 252, 0.15)"; sColor = "#e879f9"; sBorder = "rgba(192, 132, 252, 0.3)";
                                    break;
                            }
                            var isApproved = job.Status == "Approved";

                            <tr style="border-bottom: 1px solid var(--border); transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.02)';" onmouseout="this.style.background='transparent';">
                                <td style="padding: 1rem 1.5rem; font-weight: 500;">@job.JobTitle</td>
                                <td style="padding: 1rem 1.5rem; color: var(--text-muted); font-size: 0.9rem;">@job.AppliedAt.ToString("MMM dd, yyyy")</td>
                                <td style="padding: 1rem 1.5rem;">
                                    <span style="background: @sBg; color: @sColor; padding: 0.2rem 0.6rem; border-radius: 999px; font-size: 0.8rem; border: 1px solid @sBorder;">
                                        @job.Status
                                    </span>
                                </td>
                                <td style="padding: 1rem 1.5rem; text-align: right;">
                                    <div style="display: flex; gap: 0.5rem; justify-content: flex-end; align-items: center;">
                                        <a href="/candidate/job/@job.JobId" style="color: var(--secondary); text-decoration: none; font-size: 0.85rem; font-weight: 500;">View</a>

                                        @if (!isApproved)
                                        {
                                            <a href="/candidate/application/edit/@job.ApplicationId" style="color: #facc15; text-decoration: none; font-size: 0.85rem; font-weight: 500;">Replace</a>

                                            <form method="post" action="/candidate/application/delete/@job.ApplicationId" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this application?');">
                                                <button type="submit" style="background: none; border: none; color: #ef4444; cursor: pointer; font-size: 0.85rem; font-weight: 500; padding: 0;">Delete</button>
                                            </form>
                                        }
                                        else
                                        {
                                            <span style="color: var(--text-muted); font-size: 0.8rem; font-style: italic;">Locked</span>
                                        }
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>

</div>
